---
output: github_document
---


```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

```{r, include=FALSE}
JQuantsR::authorize()
```

# JQuantsR

<!-- badges: start -->
<!-- badges: end -->

J-Quants API is the API that provides Japanese stock data, such as daily stock price and financial data, from Japan Exchange Group (JPX).

JQuantsR is a R package of J-Quants API wrapper.

## Installation

You can install JQuantsR from GitHub as follows.

```{r, eval=FALSE}
install.packages("remotes")
remotes::install_github("J-Quants/JQuantsR")
```


## Registration of J-Quants API and getting refresh token

Before using JQuantsR, you have to register J-Quants API from [here](https://application.jpx-jquants.com/register).

Then, [login](https://application.jpx-jquants.com/) and get "refresh token".


## Usage

### Summary

Each function of JQuantsR is the wrapper funtion of POST or GET method of J-Quants API, and transform fetched data to a tibble (except for `JQuantsR::authorize()`).

For detailed information about parameters and returns of each function, refer to [J-Quants API Reference](https://jpx.gitbook.io/j-quants-api/api-reference) and JQuantsR help document.

- `JQuantsR::authorize()`: POST method to "https://api.jpx-jquants.com/v1/token/auth_refresh"
- `JQuantsR::get_sections()`: GET method to "https://api.jpx-jquants.com/v1/listed/sections"
- `JQuantsR::get_daily_quotes()`: GET method to "https://api.jpx-jquants.com/v1/prices/daily_quotes"
- `JQuantsR::get_financial_statements()`: GET method to "https://api.jpx-jquants.com/v1/fins/statements"
- `JQuantsR::get_financial_announcement()`: GET method to "https://api.jpx-jquants.com/v1/fins/annoucement"


### Acquisition of ID token

- **Before using the following functions whose name starts with "get_", you need to run `JQuantsR::authorize()` to acquire your ID token.**
  - `JQuantsR::authorize()` returns your ID token and automatically set your ID token to a environment variable named "JQUANTSR_ID_TOKEN".
  - So, once you run `JQuantsR::authorize()`, you don't have to set parameter `id_token` to other functions, since the default parameter of id_token is `Sys.getenv("JQUANTSR_ID_TOKEN")`.
    - Otherwise, you have to set "id_token" parameter to the those functions manually (not recommended).
- Validity period of refresh token is 1 week and that of ID token is 24 hours.
  - If refresh token are expired, login from [here](https://application.jpx-jquants.com/) and get "refresh token".
  - If ID token are expired, run `JQuantsR::authorize()` and get the latest ID token.

```{r, eval=FALSE}
JQuantsR::authorize(refresh_token = Sys.getenv("JQUANTSR_REFRESH_TOKEN"))
```

If you have set a environment variable named "JQUANTSR_REFRESH_TOKEN", you don't have to set parameter `refresh_token`, since the default parameter of refresh_token is `Sys.getenv("JQUANTSR_REFRESH_TOKEN")`. It is recommended to set your refresh token to "JQUANTSR_REFRESH_TOKEN" in `.Renviron` file.

### Getting listed info

```{r}
JQuantsR::get_info()
```

```{r}
JQuantsR::get_info(code = "86970")
```

### Getting listed sections

```{r}
JQuantsR::get_sections()
```

### Getting daily stock price

```{r}
JQuantsR::get_daily_quotes(code = "86970")
```

```{r}
JQuantsR::get_daily_quotes(code = "86970", from = "20220701", to = "20220715")
```

```{r}
JQuantsR::get_daily_quotes(date = "20220701")
```

### Getting financial statements

```{r}
JQuantsR::get_financial_statements(code = "86970")
```

### Getting financial annoucement

If there is no financial annoucement the next day, the return is `NULL`.

```{r}
JQuantsR::get_financial_announcement()
```

## Additional Information

- J-Quants API is beta version, so the specs of JQuantsR may be changed.
- J-Quants takes no responsibility for any damages that might occur in using J-Quants API and JQuantsR.

## Reference

- [J-Quants API](https://application.jpx-jquants.com/)
- [API Reference](https://jpx.gitbook.io/j-quants-api/api-reference)
  - [Data Update Time](https://jpx.gitbook.io/j-quants-api/api-reference/data-update)
